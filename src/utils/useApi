import { useEffect, useState } from 'react';

const cache = {};

export default function useApiData() {
  const [apiData, setApiData] = useState();
  const [loading, setLoading] = useState(false);

  const nbaStandingsUrl =
    'https://api.sportsdata.io/v3/nba/scores/json/Standings/2024?key=b461640f8b2641b8bcaf42396b30ba9a';

  const fecthData = async () => {
    setLoading(true);
    try {
      let nbaData;
      if (cache['nbaData']) {
        nbaData = cache['nbaData'];
        console.log('nbaData successfully loaded from cache');
      } else {
        const response = await fetch(nbaStandingsUrl);
        console.log('API called from fetchData');

        if (response.status === 200) {
          nbaData = await response.json();
          cache['nbaData'] = nbaData;
        } else {
          console.log('Server Error', response.statusText);
          setLoading(false);
          return;
        }
      }
      setApiData(nbaData);
    } catch (error) {
      console.log('Fetch Error:', error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fecthData();
  }, []);

  const getAllNbaTeamNames = (apiData) => {
    const nbaTeamsNames = apiData?.map((team) => {
      const teamName = `${team.City} ${team.Name}`;
      return teamName;
    });
    return nbaTeamsNames;
  };

  return {
    apiData,
    loading,
    getAllNbaTeamNames: () => getAllNbaTeamNames(apiData),
  };
}
